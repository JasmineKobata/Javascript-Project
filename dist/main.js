!function(){"use strict";!function(){var t=class{constructor(t,e){this.team=t,this.pos=e,this.image=new Image}parentType(){return Object.getPrototypeOf(this.constructor).name}type(){return this.constructor.name}},e=class extends t{constructor(t,e){super(t,e),this.image.src="./resources/barracks2.png"}},s=class extends t{constructor(t,e){super(t,e)}},i=class extends t{constructor(t,e){super(t,e),this.team===p.PLAYER_TEAM?this.image.src="./resources/treasureblue.png":this.image.src="./resources/treasurered.png"}};function r(t){return t.x>-1&&t.x<p.GRID_WIDTH&&t.y>-1&&t.y<p.GRID_HEIGHT}Array.prototype.get=function(t){return this[t.y][t.x]},Array.prototype.last=function(){return this[this.length-1]},Array.prototype.first=function(){return this[0]},Object.prototype.equals=function(t){return this.x===t.x&&this.y===t.y};var a=class extends t{constructor(t,e){super(t,e),this.attack=null,this.defense=null,this.pointStandard=null,this.upgrade=null,this.attackDist=1,this.moves=null,this.attacks=[],this.hasMoved=!1,this.hasAttacked=!1,this.hasUpgraded=!1,this.board=null,this.view=null}resetActions(){this.moves=null,this.attacks=[]}upgrades(){this.hasUpgraded=!0,this.attack=this.upgrade.attack,this.defense=this.upgrade.defense}downgrade(){this.attack=this.pointStandard.attack,this.defense=Math.min(this.pointStandard.defense,this.defense)}getMoves(){return this.moves=this.getMovesSet(),this.moves.delete(JSON.stringify(this.pos)),this.moves=[...this.moves].map((t=>JSON.parse(t))),this.moves}getMovesSet(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Set,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.pos;if(0===e)return t;for(let i=s.y-1;i<=s.y+1;i++)for(let a=s.x-1;a<=s.x+1;a++){let s={y:i,x:a};r(s)&&!this.hasUnit(s)&&(t.has(JSON.stringify(s))||t.add(JSON.stringify(s)),t=this.getMovesSet(t,e-1,s))}return t}getAttacks(){for(let t=this.pos.y-this.attackDist;t<=this.pos.y+this.attackDist;t++)for(let e=this.pos.x-this.attackDist;e<=this.pos.x+this.attackDist;e++){let s={y:t,x:e};if(r(s)){let t=this.board.grid.get(s);this.hasUnit(s)&&t.last().team!==this.team&&this.attacks.push(s)}}return this.attacks}hasUnit(t){let e=this.board.grid.get(t);return e.length>0&&"Unit"===e.last().parentType()}isUpgradable(t){return this.team===t.team&&this.attack===this.pointStandard.attack&&(this.team===p.PLAYER_TEAM&&this.pos.y<p.GRID_HEIGHT/2||this.team===p.ENEMY_TEAM&&this.pos.y>=p.GRID_HEIGHT/2)}onHomeTerf(){return this.team===p.PLAYER_TEAM&&this.pos.y>=p.GRID_HEIGHT/2||this.team===p.ENEMY_TEAM&&this.pos.y<p.GRID_HEIGHT/2}},n=class extends a{constructor(t,e){super(t,e),this.attack=1,this.defense=1,this.attackDist=2,this.upgrade={attack:2,defense:2},this.pointStandard={attack:1,defense:1},this.image.src="./resources/archer.png"}},o=class extends a{constructor(t,e){super(t,e),this.attack=1,this.defense=3,this.upgrade={attack:2,defense:5},this.pointStandard={attack:1,defense:3},this.image.src="./resources/defender.png"}},l=class extends a{constructor(t,e){super(t,e),this.attack=2,this.defense=2,this.upgrade={attack:4,defense:3},this.pointStandard={attack:2,defense:2},this.image.src="./resources/infantry.png"}};function h(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class c{constructor(){let t={y:c.GRID_HEIGHT-1,x:Math.floor(c.GRID_WIDTH/2)},e={y:0,x:Math.floor(c.GRID_WIDTH/2)};this.treasure={player:new i(c.PLAYER_TEAM,t),enemy:new i(c.ENEMY_TEAM,e)},t={y:0,x:Math.floor(c.GRID_WIDTH/2)},e={y:c.GRID_HEIGHT-1,x:Math.floor(c.GRID_WIDTH/2)},this.base={player:new s(c.PLAYER_TEAM,e),enemy:new s(c.ENEMY_TEAM,t)},this.grid=c.makeGrid(this.treasure,this.base)}static makeGrid(t,s){let i=[];for(let t=0;t<c.GRID_HEIGHT;t++){i.push([]);for(let e=0;e<c.GRID_WIDTH;e++)i[t].push([])}let r={y:0,x:0};return i.get(r).push(new e(c.ENEMY_TEAM,r)),r={y:0,x:c.GRID_WIDTH-1},i.get(r).push(new e(c.ENEMY_TEAM,r)),r={y:c.GRID_HEIGHT-1,x:0},i.get(r).push(new e(c.PLAYER_TEAM,r)),r={y:c.GRID_HEIGHT-1,x:c.GRID_WIDTH-1},i.get(r).push(new e(c.PLAYER_TEAM,r)),i.get(s.enemy.pos).push(s.enemy),i.get(s.player.pos).push(s.player),i.get(t.enemy.pos).push(t.enemy),i.get(t.player.pos).push(t.player),i}isWon(){return this.treasure.player.pos.equals(this.base.enemy.pos)||this.treasure.enemy.pos.equals(this.base.player.pos)}}h(c,"GRID_WIDTH",7),h(c,"GRID_HEIGHT",8),h(c,"PLAYER_TEAM",1),h(c,"ENEMY_TEAM",2);var d,u,p=c,y=class{constructor(t,e,s){this.team=t,this.units=[],this.treasure=e,this.base}removeUnit(t){let e=!1,s=0;for(;!e&&s<this.units.length;)this.units[s++].pos.equals(t.pos)&&(e=!0);return this.units.splice(s-1,1),this.units}},x=class extends y{constructor(t){super(t)}};class E{constructor(t,e,s){this.game=t,this.el=s,this.ctx=e,this.ratio=null,this.images=this.renderImg(),this.drawBoard(),this.drawMenu({y:p.GRID_HEIGHT,x:p.GRID_WIDTH})}resetView(t){this.game=t,this.ratio=null,this.drawBoard()}clearBoard(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}drawBoard(t,e){this.clearBoard(),this.invisifyButtons(),this.images.background.onload(t,e)}invisifyButtons(){const t=[];t.push(document.querySelector(".about")),t.push(document.querySelector(".rules")),t.push(document.querySelector(".abouttitle")),t.push(document.querySelector(".rulestitle")),t.forEach((t=>{t&&(t.style.visibility="hidden")}))}drawBoardWithoutOnload(t,e){for(let s=0;s<p.GRID_HEIGHT;s++)for(let i=0;i<p.GRID_WIDTH;i++)this.drawGridSquare(i,s,"darkgreen"),this.drawGridElems({y:s,x:i},t,e);this.drawMidline(),this.drawEndTurnButton(),this.ctx.font="40px Copperplate",this.game.currentPlayer.team===p.ENEMY_TEAM?this.ctx.fillStyle="red":this.ctx.fillStyle="blue";let s="Action Points: "+this.game.actionPoints.toString();this.ctx.strokeStyle="dimgrey",this.ctx.lineWidth=3,this.ctx.strokeText(s,10,(p.GRID_HEIGHT+.5)*E.SQUARE_DIM),this.ctx.fillText(s,10,(p.GRID_HEIGHT+.5)*E.SQUARE_DIM),this.ctx.font="30px Copperplate",s="Troops: "+this.game.currentPlayer.units.length.toString()+"/8",this.ctx.strokeText(s,10,(p.GRID_HEIGHT+.75)*E.SQUARE_DIM),this.ctx.fillText(s,10,(p.GRID_HEIGHT+.75)*E.SQUARE_DIM)}drawMidline(){this.ctx.strokeStyle="lightskyblue",this.ctx.beginPath(),this.ctx.moveTo(0,p.GRID_HEIGHT/2*E.SQUARE_DIM),this.ctx.lineTo((p.GRID_HEIGHT-1)*E.SQUARE_DIM,p.GRID_HEIGHT/2*E.SQUARE_DIM),this.ctx.stroke()}drawEndTurnButton(){this.ctx.fillStyle="lightskyblue",this.ctx.fillRect(4*E.SQUARE_DIM,(p.GRID_HEIGHT+.25)*E.SQUARE_DIM,1*E.SQUARE_DIM,.5*E.SQUARE_DIM),this.ctx.strokeStyle="cornflowerblue",this.ctx.lineWidth=1,this.ctx.strokeRect(4*E.SQUARE_DIM,(p.GRID_HEIGHT+.25)*E.SQUARE_DIM,1*E.SQUARE_DIM,.5*E.SQUARE_DIM),this.ctx.font="25px Copperplate",this.ctx.fillStyle="dimgrey",this.ctx.lineWidth=2,this.ctx.fillText("End",4.25*E.SQUARE_DIM,(p.GRID_HEIGHT+.45)*E.SQUARE_DIM),this.ctx.fillText("Turn",4.15*E.SQUARE_DIM,(p.GRID_HEIGHT+.65)*E.SQUARE_DIM)}drawMenu(t){const e=document.createElement("ul");e.classList.add("grid");let s=100*this.ratio,i=50*this.ratio;e.style.width=s.toString()+"px",e.style.height=i.toString()+"px";const r=document.createElement("li");r.style.backgroundColor="lightskyblue",r.style.border="1px solid cornflowerblue",r.style.width=e.style.width,r.style.height=e.style.height,r.style.position="absolute",r.style.left=((t.x-1.5)*this.ratio*E.SQUARE_DIM).toString()+"px",r.style.top=((t.y+.32)*this.ratio*E.SQUARE_DIM).toString()+"px",r.style.margin="0px",r.style.listStyle="none",r.style.cursor="pointer",r.innerHTML="Menu",r.style.font="25px Copperplate",r.style.color="dimgrey",r.style.textAlign="center",r.style.lineHeight=(50*this.ratio).toString()+"px",r.classList.add("button"),e.appendChild(r),this.el.appendChild(e),this.drawMenuOptions(t),this.drawRules(t),this.drawAbout(t)}drawMenuOptions(t){const e=document.createElement("ul");e.classList.add("menu");let s=100*this.ratio,i=50*this.ratio;e.style.width=s.toString()+"px",e.style.height=i.toString()+"px";const r=document.createElement("li");this.drawButton("Rules",r,{x:t.x,y:t.y-.5},e),r.classList.add("rules");const a=document.createElement("li");this.drawButton("About",a,t,e),a.classList.add("about"),e.appendChild(r),e.appendChild(a),e.style.visibility="hidden",this.el.appendChild(e)}drawRules(t){const e=document.createElement("ul");e.classList.add("rulestitle"),this.drawMenuDisplayBox("How To Play",e,e);const s=document.createElement("li");this.drawMenuInnerDisplayBox("Steal the enemy's treasure & bring it back to your base!<p>BUYING | Select the barracks to buy troops. All units can move up to 2 spaces in any direction. There are 3 types of troops:</p>-Infantry: Defense 2, Attack 1, Range 1<br>-Archer: Defense 1, Attack 1, Range 2<br>-Defender: Defense 3, Attack 1, Range 1<br><p>UPGRADING | When in enemy territory, units can be ugraded as follows:</p>-Infantry: Defense +1, Attack +2<br>-Archer: Defense +1, Attack +1<br>-Defender: Defense +2, Attack +1<br><p>Units cannot attack after upgrading until the next round. Stats return to normal once returning to friendly territory.</p><p>TREASURE | Pick up the treasure by moving a unit onto the square containing it. (You can only pick up enemy treasure.)</p><p>PRICE CHART<br>Moving or Attacking: 1 Action Point<br>Buying or Upgrading: 2 Action Points</p>",s,e),s.style.font="12px Copperplate",s.classList.add("rulesbox"),e.appendChild(s),e.style.visibility="hidden",this.el.appendChild(e)}drawAbout(t){const e=document.createElement("ul");e.classList.add("abouttitle"),this.drawMenuDisplayBox("About",e,e);const s=document.createElement("li");this.drawMenuInnerDisplayBox("<br><br><br><br><br><p>Game developed by Jasmine Kobata</p><br><p><a href='https://github.com/JasmineKobata/Javascript-Project'>Treasure Wars! GitHub Repo</p><br><p><a href='https://www.appacademy.io/'>App Academy</a> Javascript Project</p>",s,e),s.style.font="15px Copperplate",s.classList.add("aboutbox"),e.appendChild(s),e.style.visibility="hidden",this.el.appendChild(e)}drawMenuDisplayBox(t,e,s){let i=450*this.ratio,r=600*this.ratio;e.style.width=i.toString()+"px",e.style.height=r.toString()+"px",e.style.backgroundColor="lightskyblue",e.style.border="1px solid cornflowerblue",e.style.position="absolute",e.style.left=(this.ratio*(E.SQUARE_DIM+10)).toString()+"px",e.style.top=(this.ratio*(E.SQUARE_DIM+10)).toString()+"px",e.style.margin="0px",e.style.listStyle="none",e.style.cursor="pointer",e.innerHTML=t,e.style.font="25px Copperplate",e.style.color="dimgrey",e.style.textAlign="center",e.style.lineHeight=(50*this.ratio).toString()+"px"}drawMenuInnerDisplayBox(t,e,s){let i=375*this.ratio,r=475*this.ratio;e.style.width=i.toString()+"px",e.style.height=r.toString()+"px",e.style.backgroundColor="cornflowerblue",e.style.border="1px solid cornflowerblue",e.style.position="absolute",e.style.left=(this.ratio*(E.SQUARE_DIM/2+10)).toString()+"px",e.style.top=(this.ratio*(E.SQUARE_DIM/2+10)).toString()+"px",e.style.margin="0px",e.style.listStyle="none",e.style.cursor="pointer",e.innerHTML=t,e.style.font="25px Copperplate",e.style.color="white",e.style.textAlign="center"}drawButton(t,e,s,i){e.style.backgroundColor="lightskyblue",e.style.border="1px solid cornflowerblue",e.style.width=i.style.width,e.style.height=i.style.height,e.style.position="absolute",e.style.left=((s.x-1.5)*this.ratio*E.SQUARE_DIM).toString()+"px",e.style.top=((s.y+.32)*this.ratio*E.SQUARE_DIM).toString()+"px",e.style.margin="0px",e.style.listStyle="none",e.style.cursor="pointer",e.innerHTML=t,e.style.font="20px Copperplate",e.style.color="dimgrey",e.style.textAlign="center",e.style.lineHeight=(50*this.ratio).toString()+"px"}drawWinningScreen(){let t=new Image;t.src="./resources/wood.png",t.onload=()=>{this.ctx.drawImage(t,E.SQUARE_DIM*Math.floor((p.GRID_WIDTH-2)/2),E.SQUARE_DIM*(Math.floor((p.GRID_HEIGHT-2)/2)+.25),3*E.SQUARE_DIM,1.5*E.SQUARE_DIM),this.ctx.beginPath(),this.ctx.stroke(),this.ctx.font="30px Copperplate",this.ctx.lineWidth=3;let e="";this.game.currentPlayer.team===p.PLAYER_TEAM?(this.ctx.fillStyle="blue",this.ctx.strokeStyle="darkblue",e+="Blue"):(this.ctx.fillStyle="red",this.ctx.strokeStyle="maroon",e+="Red"),e+=" Victory!",this.ctx.strokeText(e,E.SQUARE_DIM*(p.GRID_WIDTH/2-1),E.SQUARE_DIM*(p.GRID_HEIGHT/2-.25)),this.ctx.fillText(e,E.SQUARE_DIM*(p.GRID_WIDTH/2-1),E.SQUARE_DIM*(p.GRID_HEIGHT/2-.25)),this.drawPlayAgainButton()}}drawPlayAgainButton(){this.ctx.lineWidth=2,this.ctx.fillStyle="cornflowerblue",this.ctx.strokeStyle="#543000",this.ctx.fillRect(E.SQUARE_DIM*(p.GRID_WIDTH/2-.75),E.SQUARE_DIM*Math.floor(p.GRID_HEIGHT/2),1.5*E.SQUARE_DIM,.5*E.SQUARE_DIM),this.ctx.strokeRect(E.SQUARE_DIM*(p.GRID_WIDTH/2-.75),E.SQUARE_DIM*Math.floor(p.GRID_HEIGHT/2),1.5*E.SQUARE_DIM,.5*E.SQUARE_DIM),this.ctx.strokeStyle="blue",this.ctx.font="24px Copperplate",this.ctx.lineWidth=1,this.ctx.fillStyle="white",this.ctx.strokeStyle="grey",this.ctx.strokeText("Play Again?",E.SQUARE_DIM*(p.GRID_WIDTH/2-.7),E.SQUARE_DIM*(p.GRID_HEIGHT/2+.3)),this.ctx.fillText("Play Again?",E.SQUARE_DIM*(p.GRID_WIDTH/2-.7),E.SQUARE_DIM*(p.GRID_HEIGHT/2+.3))}drawUpgradeConfirmation(t){this.ctx.fillStyle="lightskyblue",this.ctx.fillRect(E.SQUARE_DIM*t.x,E.SQUARE_DIM*t.y,1*E.SQUARE_DIM,.35*E.SQUARE_DIM),this.ctx.strokeStyle="cornflowerblue",this.ctx.strokeRect(E.SQUARE_DIM*t.x,E.SQUARE_DIM*t.y,1*E.SQUARE_DIM,.35*E.SQUARE_DIM),this.ctx.lineWidth=1,this.ctx.font="20px Copperplate",this.ctx.fillStyle="dimgrey",this.ctx.fillText("Upgrade?",E.SQUARE_DIM*t.x,E.SQUARE_DIM*(t.y+.25))}drawBarrackSelection(t){let e=this.adjustMenuPosition(t);this.team===p.ENEMY_TEAM?this.ctx.fillStyle="red":this.ctx.fillStyle="blue";let s=[];this.images.barrack.onload(e),this.ctx.font="30px Copperplate",this.ctx.fillStyle="white",this.ctx.lineWidth=3,this.ctx.fillText("Buy New Troop?",E.SQUARE_DIM*(e.x+.35),E.SQUARE_DIM*(e.y+.35));let i=new l(this.game.currentPlayer.team,{y:e.y+.5,x:e.x}),r=new n(this.game.currentPlayer.team,{y:e.y+.5,x:e.x+1}),a=new o(this.game.currentPlayer.team,{y:e.y+.5,x:e.x+2});return i.board=this.game.board,r.board=this.game.board,a.board=this.game.board,i.view=this.game.view,r.view=this.game.view,a.view=this.game.view,s.push(i),s.push(r),s.push(a),s.forEach((t=>{t.draw(this.ctx,this.game.currentPlayer)})),s}adjustMenuPosition(t){let e={};return 0===t.x?e.x=t.x+.25:e.x=t.x-2.25,0===t.y?e.y=t.y+.5:e.y=t.y-1,e}drawOutline(t){this.ctx.strokeStyle="yellow",this.ctx.lineWidth=10,this.ctx.strokeRect(E.SQUARE_DIM*t.x,E.SQUARE_DIM*t.y,E.SQUARE_DIM,E.SQUARE_DIM)}drawMoveHighlights(t){this.drawGridSquare(t.x,t.y,"seagreen","mediumseagreen")}drawAttackHighlights(t){this.drawGridSquare(t.x,t.y,"cornflowerblue","lightskyblue")}drawGridElems(t,e,s){let i=this.game.board.grid.get(t);for(let t=0;t<i.length;t++)i[t].draw(this.ctx,this.game.currentPlayer,e,s);this.ctx.beginPath()}drawGridSquare(t,e,s,i){i&&(this.ctx.fillStyle=i,this.ctx.globalAlpha=.6,this.ctx.fillRect(E.SQUARE_DIM*t,E.SQUARE_DIM*e,E.SQUARE_DIM,E.SQUARE_DIM)),this.ctx.strokeStyle=s,this.ctx.lineWidth=2,this.ctx.strokeRect(E.SQUARE_DIM*t,E.SQUARE_DIM*e,E.SQUARE_DIM,E.SQUARE_DIM),this.ctx.globalAlpha=1}renderImg(){let t=p.GRID_WIDTH*E.SQUARE_DIM,e=(p.GRID_HEIGHT+1)*E.SQUARE_DIM;this.ctx.canvas.width=t,this.ctx.canvas.height=e,this.ratio=Math.min(window.innerHeight/this.ctx.canvas.height,window.innerWidth/this.ctx.canvas.width),this.ctx.scale(this.ratio,this.ratio);let s={};return s.background=new Image,s.background.src="./resources/grass2.png",s.background.onload=(i,r)=>{this.ctx.drawImage(s.background,0,0,t,e,0,0,t,e),this.ctx.beginPath(),this.ctx.stroke(),this.drawBoardWithoutOnload(i,r)},s.barrack=new Image,s.barrack.src="./resources/wood.png",s.barrack.onload=t=>{this.ctx.drawImage(s.barrack,E.SQUARE_DIM*t.x,E.SQUARE_DIM*t.y,3*E.SQUARE_DIM,1.5*E.SQUARE_DIM),this.ctx.beginPath(),this.ctx.stroke()},s}bindEvents(t){document.querySelector(".button").addEventListener("click",this.handleButton.bind(this));const e=document.querySelector(".about");e&&e.addEventListener("click",this.handleAbout.bind(this));const s=document.querySelector(".rules");s&&s.addEventListener("click",this.handleRules.bind(this)),t.canvas.addEventListener("click",this.handleClick.bind(this))}handleAbout(t){const e=document.querySelector(".abouttitle");this.invisifyButtons(),e.style.visibility="visible"}handleRules(t){const e=document.querySelector(".rulestitle");this.invisifyButtons(),e.style.visibility="visible"}handleButton(t){const e=document.querySelector(".about"),s=document.querySelector(".rules");e.style.visibility="visible",s.style.visibility="visible"}handleClick(t){let e=Math.floor(t.offsetX/(E.SQUARE_DIM*this.ratio)),s=Math.floor(t.offsetY/(E.SQUARE_DIM*this.ratio)),i=t.offsetX/(E.SQUARE_DIM*this.ratio),a={y:s,x:e},n={y:t.offsetY/(E.SQUARE_DIM*this.ratio),x:i};this.game.board.isWon()?function(t){return t.x>p.GRID_WIDTH/2-.75&&t.x<p.GRID_WIDTH/2+.75&&t.y>Math.floor(p.GRID_HEIGHT/2)&&t.y<Math.floor(p.GRID_HEIGHT/2)+.5}(n)&&(this.game.resetGame(this),this.drawBoard()):(this.drawBoard(),r(a)?(this.game.ctx.clickedPos=a,this.game.ctx.exactPos=n,this.game.stateMachine()):function(t){return t.y>p.GRID_HEIGHT+.25&&t.y<p.GRID_HEIGHT+.75&&t.x>4&&t.x<5}(n)&&(this.game.switchPlayers(),this.drawBoard()))}}d=E,(u=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(u="SQUARE_DIM"))in d?Object.defineProperty(d,u,{value:100,enumerable:!0,configurable:!0,writable:!0}):d[u]=100,e.prototype.draw=function(t){this.team===p.ENEMY_TEAM?t.fillStyle="red":t.fillStyle="blue",t.fillRect(E.SQUARE_DIM*this.pos.x+.1*E.SQUARE_DIM,E.SQUARE_DIM*this.pos.y+.7*E.SQUARE_DIM,.8*E.SQUARE_DIM,.2*E.SQUARE_DIM),this.image.onload=()=>{t.drawImage(this.image,E.SQUARE_DIM*this.pos.x,E.SQUARE_DIM*this.pos.y,E.SQUARE_DIM,E.SQUARE_DIM),t.beginPath(),t.stroke()},this.image.onload()},s.prototype.draw=function(t){this.team===p.ENEMY_TEAM?t.fillStyle="red":t.fillStyle="blue",t.beginPath(),t.arc(E.SQUARE_DIM*this.pos.x+.5*E.SQUARE_DIM,E.SQUARE_DIM*this.pos.y+.5*E.SQUARE_DIM,.35*E.SQUARE_DIM,0,2*Math.PI),t.fill()},i.prototype.draw=function(t){this.image.onload=()=>{t.drawImage(this.image,E.SQUARE_DIM*this.pos.x,E.SQUARE_DIM*this.pos.y,E.SQUARE_DIM,E.SQUARE_DIM),t.beginPath(),t.stroke()},this.image.onload()},a.prototype.draw=function(t,e,s,i){this.team===p.ENEMY_TEAM?t.fillStyle="red":t.fillStyle="blue",this.image.onload=()=>{t.drawImage(this.image,E.SQUARE_DIM*this.pos.x,E.SQUARE_DIM*this.pos.y,E.SQUARE_DIM,E.SQUARE_DIM),t.beginPath(),t.stroke(),function(t,e,s,i){t.team===p.ENEMY_TEAM?e.fillStyle="red":e.fillStyle="blue",e.font="35px Copperplate",e.strokeStyle="dimgrey",e.lineWidth=3,e.strokeText("A"+t.attack.toString(),E.SQUARE_DIM*s+.3*E.SQUARE_DIM,E.SQUARE_DIM*i+.5*E.SQUARE_DIM),e.strokeText("D"+t.defense.toString(),E.SQUARE_DIM*s+.3*E.SQUARE_DIM,E.SQUARE_DIM*i+.75*E.SQUARE_DIM),e.fillText("A"+t.attack.toString(),E.SQUARE_DIM*s+.3*E.SQUARE_DIM,E.SQUARE_DIM*i+.5*E.SQUARE_DIM),e.fillText("D"+t.defense.toString(),E.SQUARE_DIM*s+.3*E.SQUARE_DIM,E.SQUARE_DIM*i+.75*E.SQUARE_DIM)}(this,t,this.pos.x,this.pos.y),this.isUpgradable(e)&&(function(t,e,s,i){t.team===p.ENEMY_TEAM?e.fillStyle="red":e.fillStyle="blue",e.beginPath(),e.arc(E.SQUARE_DIM*s+.15*E.SQUARE_DIM,E.SQUARE_DIM*i+.15*E.SQUARE_DIM,.1*E.SQUARE_DIM,0,2*Math.PI),e.fill(),e.fillStyle="white",e.font="30px Copperplate",e.fillText("+",E.SQUARE_DIM*s+.06*E.SQUARE_DIM,E.SQUARE_DIM*i+.22*E.SQUARE_DIM)}(this,t,this.pos.x,this.pos.y),s&&i&&function(t,e){t.fillStyle="lightskyblue",t.fillRect(E.SQUARE_DIM*e.x,E.SQUARE_DIM*e.y,1*E.SQUARE_DIM,.35*E.SQUARE_DIM),t.strokeStyle="cornflowerblue",t.strokeRect(E.SQUARE_DIM*e.x,E.SQUARE_DIM*e.y,1*E.SQUARE_DIM,.35*E.SQUARE_DIM),t.lineWidth=1,t.font="20px Copperplate",t.fillStyle="dimgrey",t.fillText("Upgrade?",E.SQUARE_DIM*e.x,E.SQUARE_DIM*(e.y+.25))}(t,s))},this.image.onload()};var g=E;document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("treasure-game").getContext("2d"),e=document.querySelector(".buttons"),s=new class{constructor(){this.board=new p,this.view=null,this.state="unselected",this.player=new x(p.PLAYER_TEAM),this.enemy=new x(p.ENEMY_TEAM),this.currentPlayer=this.player,this.actionPoints=4,this.ctx={}}resetGame(t){this.board=new p,this.view=t,this.state="unselected",this.player=new x(p.PLAYER_TEAM),this.enemy=new x(p.ENEMY_TEAM),this.currentPlayer=this.player,this.actionPoints=4,this.ctx={}}switchPlayers(){this.board.grid.forEach((t=>{t.forEach((t=>{t.forEach((t=>{"Unit"===t.parentType()&&(t.hasMoved=!1,t.hasAttacked=!1,t.hasUpgraded=!1)}))}))})),this.actionPoints=4,this.state="unselected",this.currentPlayer===this.player?this.currentPlayer=this.enemy:this.currentPlayer=this.player}stateMachine(){let t=this.board.grid.get(this.ctx.clickedPos);switch(this.state){case"unselected":this.unitUpgradeable(this.ctx.exactPos,t.last())?(this.ctx.selectedSquare=t,this.state="upgrade"):this.unitSelected(t.last())?(this.ctx.selectedSquare=t,this.state="unit"):this.actionPoints>1&&this.currentPlayer.units.length<8&&this.barrackSelected(t.first())&&(this.ctx.menu=this.view.drawBarrackSelection(t.first().pos),this.ctx.selectedSquare=t,this.state="barrack");break;case"unit":this.actionTaken(this.ctx.clickedPos,this.ctx.selectedSquare)?(this.ctx={},this.state="unselected",this.board.isWon()?(this.view.drawBoard(),this.view.drawWinningScreen()):(0===this.actionPoints&&this.switchPlayers(),this.view.drawBoard())):(this.view.drawBoard(),this.unitUpgradeable(this.ctx.exactPos,t.last())?this.state="upgrade":this.unitSelected(t.last())||(this.actionPoints>1&&this.currentPlayer.units.length<8&&this.barrackSelected(t.first())?(this.ctx.menu=this.view.drawBarrackSelection(t.first().pos),this.state="barrack"):this.state="unselected"),this.ctx.selectedSquare=t);break;case"barrack":this.unitBought(this.ctx.exactPos,this.ctx.menu,this.ctx.selectedSquare)?(this.ctx={},this.state="unselected",0===this.actionPoints&&this.switchPlayers(),this.view.drawBoard()):(this.view.drawBoard(),this.unitUpgradeable(this.ctx.exactPos,t.last())?this.state="upgrade":this.unitSelected(t.last())?this.state="unit":this.barrackSelected(t.first())?this.ctx.menu=this.view.drawBarrackSelection(t.first().pos):this.state="unselected",this.ctx.selectedSquare=t);break;case"upgrade":this.unitUpgraded(this.ctx.exactPos,this.ctx.selectedSquare)?(this.state="unselected",0===this.actionPoints&&this.switchPlayers(),this.view.drawBoard()):(this.view.drawBoard(),this.unitUpgradeable(this.ctx.exactPos,t.last())||(this.unitSelected(t.last())?this.state="unit":this.actionPoints>1&&this.currentPlayer.units.length<8&&this.barrackSelected(t.first())?(this.ctx.menu=this.view.drawBarrackSelection(t.first().pos),this.state="barrack"):this.state="unselected"),this.ctx.selectedSquare=t)}}unitUpgradeable(t,e){let s=!1;return this.actionPoints>1&&e&&"Unit"===e.parentType()&&e.isUpgradable(this.currentPlayer)&&function(t,e){let s=e.x-t.x,i=e.y-t.y;return s>0&&s<.25&&i>0&&i<.25}(e.pos,t)&&(s=!0,this.view.drawBoard(e.pos,t)),s}unitUpgraded(t,e){let s=!1,i=e.last();return i&&"Unit"===i.parentType()&&i.isUpgradable(this.currentPlayer)&&function(t,e){let s=e.x-t.x,i=e.y-t.y;return s>0&&s<1&&i>0&&i<.25}(i.pos,t)&&(i.upgrades(),this.actionPoints-=2,s=!0),s}unitSelected(t){let e=!1;return t&&"Unit"===t.parentType()&&t.team===this.currentPlayer.team&&(t.resetActions(),t.board||(t.board=this.board),t.view||(t.view=this.view),this.unitCallDrawSelected(t,this.view),e=!0),e}unitCallDrawSelected(t,e){t.hasMoved||t.getMoves().forEach((t=>{e.drawMoveHighlights(t),e.drawGridElems(t)})),t.hasAttacked||t.hasUpgraded||t.getAttacks().forEach((t=>{e.drawAttackHighlights(t),e.drawGridElems(t)})),e.drawOutline(t.pos)}barrackSelected(t){return t&&"Barrack"===t.type()&&t.team===this.currentPlayer.team}unitBought(t,e,s){let i,r=!1,a=this.adjustMenuPosition(s.first(),t);return(i=e.find((t=>t.pos.x===a.x&&t.pos.y===a.y)))&&(i.pos=s.first().pos,s.push(i),this.currentPlayer.units.push(i),this.actionPoints-=2,r=!0),r}adjustMenuPosition(t,e){let s=0===t.pos.x?-.25:.25,i=0===t.pos.y?-1:.5,r=Math.floor(e.x+s),a=Math.floor(e.y+i),n={};return n.x=0===t.pos.x?r+.25:r-.25,n.y=0===t.pos.y?a+1:a-.5,n}actionTaken(t,e){return this.moveUnit(t,e)||this.attackUnit(t,e)}moveUnit(t,e){let s=!1,i=e.last();return i.moves&&i.moves.find((e=>e.x===t.x&&e.y===t.y))&&(i.pos=t,i.onHomeTerf()&&i.downgrade(),e.pop(),e.length>0&&"Treasure"===e.last().type()&&e.last().team!==this.currentPlayer.team&&(e.last().pos=t,this.board.grid.get(t).push(e.pop())),this.board.grid.get(t).push(i),this.actionPoints--,i.hasMoved=!0,s=!0),s}attackUnit(t,e){let s=!1,i=e.last();if(i.attacks&&i.attacks.find((e=>e.x===t.x&&e.y===t.y))){let e=this.board.grid.get(t),r=e.last();r.defense-=i.attack,r.defense<1&&(e.pop(),this.currentPlayer.team===this.player.team?this.enemy.removeUnit(r):this.player.removeUnit(r)),this.actionPoints--,i.hasAttacked=!0,s=!0}return s}},i=new g(s,t,e);s.view=i,i.bindEvents(t)}))}()}();
//# sourceMappingURL=main.js.map